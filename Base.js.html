<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: Base.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/nav.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="text/css" rel="stylesheet" href="styles/skyceil.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
</head>

<body>

<nav class="navbar">
    <div class="utilities">
        <center>
            <button class="theme" data-theme="light">ðŸŒ™ Turn off the lights</button>
        </center>
    </div>
    <hr>
    <h4><a href="index.html">Home</a></h4><h5 class="no-bottom must-underline">Classes</h5><ul><li><span class="small-icon C">C</span><b><a href="Base.html">Base</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="Base.html#connection">connection</a></li><li><span class="small-icon M">M</span><a href="Base.html#dbURL">dbURL</a></li><li><span class="small-icon M">M</span><a href="Base.html#options">options</a></li><li><span class="small-icon M">M</span><a href="Base.html#readyAt">readyAt</a></li><li><span class="small-icon M">M</span><a href="Base.html#state">state</a></li><li><span class="small-icon M">M</span><a href="Base.html#url">url</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="Database.html">Database</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="Database.html#_eval">_eval</a></li><li><span class="small-icon F">F</span><a href="Database.html#add">add</a></li><li><span class="small-icon F">F</span><a href="Database.html#all">all</a></li><li><span class="small-icon F">F</span><a href="Database.html#connect">connect</a></li><li><span class="small-icon F">F</span><a href="Database.html#delete">delete</a></li><li><span class="small-icon F">F</span><a href="Database.html#deleteAll">deleteAll</a></li><li><span class="small-icon F">F</span><a href="Database.html#disconnect">disconnect</a></li><li><span class="small-icon F">F</span><a href="Database.html#entries">entries</a></li><li><span class="small-icon F">F</span><a href="Database.html#exists">exists</a></li><li><span class="small-icon F">F</span><a href="Database.html#export">export</a></li><li><span class="small-icon F">F</span><a href="Database.html#exportToQuickDB">exportToQuickDB</a></li><li><span class="small-icon F">F</span><a href="Database.html#fetch">fetch</a></li><li><span class="small-icon F">F</span><a href="Database.html#fetchLatency">fetchLatency</a></li><li><span class="small-icon F">F</span><a href="Database.html#get">get</a></li><li><span class="small-icon F">F</span><a href="Database.html#has">has</a></li><li><span class="small-icon F">F</span><a href="Database.html#import">import</a></li><li><span class="small-icon F">F</span><a href="Database.html#keyArray">keyArray</a></li><li><span class="small-icon F">F</span><a href="Database.html#math">math</a></li><li><span class="small-icon F">F</span><a href="Database.html#ping">ping</a></li><li><span class="small-icon F">F</span><a href="Database.html#pull">pull</a></li><li><span class="small-icon F">F</span><a href="Database.html#push">push</a></li><li><span class="small-icon F">F</span><a href="Database.html#random">random</a></li><li><span class="small-icon F">F</span><a href="Database.html#raw">raw</a></li><li><span class="small-icon F">F</span><a href="Database.html#set">set</a></li><li><span class="small-icon F">F</span><a href="Database.html#startsWith">startsWith</a></li><li><span class="small-icon F">F</span><a href="Database.html#subtract">subtract</a></li><li><span class="small-icon F">F</span><a href="Database.html#table">table</a></li><li><span class="small-icon F">F</span><a href="Database.html#toString">toString</a></li><li><span class="small-icon F">F</span><a href="Database.html#type">type</a></li><li><span class="small-icon F">F</span><a href="Database.html#updateModel">updateModel</a></li><li><span class="small-icon F">F</span><a href="Database.html#valueArray">valueArray</a></li><li><span class="small-icon M">M</span><a href="Database.html#name">name</a></li><li><span class="small-icon M">M</span><a href="Database.html#schema">schema</a></li><li><span class="small-icon M">M</span><a href="Database.html#uptime">uptime</a></li><li><span class="small-icon M">M</span><a href="Database.html#utils">utils</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="MemoryStorage.html">MemoryStorage</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="MemoryStorage.html#all">all</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#delete">delete</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#deleteAll">deleteAll</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#exists">exists</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#export">export</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#fetch">fetch</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#get">get</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#has">has</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#set">set</a></li><li><span class="small-icon F">F</span><a href="MemoryStorage.html#startsWith">startsWith</a></li></ul></li></ul><h5 class="no-bottom must-underline">Events</h5><ul><li><span class="small-icon E">E</span><a href="Base.html#event:debug">debug</a></li><li><span class="small-icon E">E</span><a href="Base.html#event:error">error</a></li><li><span class="small-icon E">E</span><a href="Base.html#event:ready">ready</a></li></ul>
</nav>

<div id="main">
    <div class="burger">
        <div class="burger-line-1"></div>
        <div class="burger-line-2"></div>
        <div class="burger-line-3"></div>
    </div>

    <h1 class="page-title">Source: Base.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const EventEmitter = require("events").EventEmitter;
const mongoose = require("mongoose");
const Error = require("./Error");

class Base extends EventEmitter {

    /**
     * Instantiates the base database.
     * This class is implemented by the main Database class.
     * @param {string} mongodbURL Mongodb Database URL.
     * @param {object} connectionOptions Mongodb connection options
     * @example const db = new Base("mongodb://localhost/mydb");
     */
    constructor(mongodbURL, connectionOptions={}) {
        super();
        if (!mongodbURL || !mongodbURL.startsWith("mongodb")) throw new Error("No mongodb url was provided!");
        if (typeof mongodbURL !== "string") throw new Error(`Expected a string for mongodbURL, received ${typeof mongodbURL}`);
        if (connectionOptions &amp;&amp; typeof connectionOptions !== "object") throw new Error(`Expected Object for connectionOptions, received ${typeof connectionOptions}`);

        /**
         * Current database url
         * @type {string}
         */
        this.dbURL = mongodbURL;

        /**
         * Mongoose connection options
         * @type {object}
         */
        this.options = connectionOptions;

        this._create();

        mongoose.connection.on("error", (e) => {
            this.emit("error", e);
        });
        mongoose.connection.on("open", () => {
            /**
             * Timestamp when database became ready
             * @type {Date}
             */
            this.readyAt = new Date();
            this.emit("ready");
        });
    }

    /**
     * Creates mongodb connection
     * @ignore
     */
    _create(url) {
        // do not create multiple connections
        if (this.state === "CONNECTED" || this.state === "CONNECTING") return;
        this.emit("debug", "Creating database connection...");
        if (url &amp;&amp; typeof url === "string") this.dbURL = url;
        if (!this.dbURL || typeof this.dbURL !== "string") throw new Error("Database url was not provided!", "MongoError");
        mongoose.connect(this.dbURL, {
            ...this.options,
            useNewUrlParser: true,
            useUnifiedTopology: true
        });
    }

    /**
     * Destroys database
     * @ignore
     */
    _destroyDatabase() {
        mongoose.disconnect();
        this.readyAt = undefined;
        this.dbURL = null;
        this.emit("debug", "Database disconnected!");
    }

    /**
     * Returns mongodb connection
     */
    get connection() {
        return mongoose.connection;
    }
    
    /**
     * Current database url
     * @type {string}
     */
    get url() {
        return this.dbURL;
    }

    /**
     * Returns database connection state
     */
    get state() {
        switch(mongoose.connection.readyState) {
            case 0:
                return "DISCONNECTED";
            case 1:
                return "CONNECTED";
            case 2:
                return "CONNECTING";
            case 3:
                return "DISCONNECTING";
        }
    }
}

/**
 * Emitted when database creates connection
 * @event Base#ready
 * @example db.on("ready", () => {
 *     console.log("Successfully connected to the database!");
 * });
 */

/**
 * Emitted when database encounters error
 * @event Base#error
 * @param {Error} Error Error Message
 * @example db.on("error", console.error);
 */

 /**
  * Emitted on debug mode
  * @event Base#debug
  * @param {String} Message Debug message
  * @example db.on("debug", console.log);
  */

module.exports = Base;</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Mon Sep 21 2020 17:36:54 GMT+0545 (Nepal Time) using <a href="https://github.com/zyrouge/jsdoc-skyceil">Skyceil Theme</a>
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

</body>
</html>
